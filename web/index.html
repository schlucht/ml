<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width,maximum-scale=0.9 user-scalable=0"
        />
        <title>Data Creatort</title>
        <link href="./styles.css" rel="stylesheet" type="text/css" />
    </head>

    <body>
        <div id="content">
            <h1>Data Creator</h1>
            <div>
                <input id="student" type="text" placeholder="type your name" />
                <span id="instructions"></span>
                <button id="advanceBtn" onclick="start()">START</button>
            </div>
            <br />
            <div id="sketchPadContainer"></div>
        </div>
        <script src="./common/draw.js"></script>
        <script src="./js/sketchPad.js"></script>
        <script>
            let index = 0;
            const labels = [
                "car",
                "fish",
                "house",
                "tree",
                "bicycle",
                "guitar",
                "pencil",
                "clock",
            ];
            const data = {
                student: null,
                session: new Date().getTime(),
                drawings: {},
            };
            const sketchPad = new SketchPad(
                document.getElementById("sketchPadContainer"),
            );
            function start() {
                if (student.value == "") {
                    alert("Please type your name first");
                    return;
                }
                data.student = student.value;
                student.style.display = "none";
                sketchPadContainer.style.visibility = "visible";
                drawLabel();
                advanceBtn.innerHTML = "NEXT";
                advanceBtn.onclick = next;
            }

            function next() {
                if (sketchPad.paths.length === 0) {
                    alert("Draw somthing first!");
                    return;
                }
                const label = labels[index];
                data.drawings[label] = sketchPad.paths;
                sketchPad.reset();
                index++;
                drawLabel();
            }

            function drawLabel() {
                if (index > labels.length - 1) {
                    instructions.innerHTML = `<strong>Thank, you!</strong>`;
                    advanceBtn.innerHTML = "SAVE";
                    advanceBtn.onclick = save;
                    return;
                }
                const label = labels[index];
                instructions.innerHTML = `Please draw a: <strong> ${label.toUpperCase()}</strong>`;
            }

            function save() {
                sketchPadContainer.style.visibility = "hidden";
                advanceBtn.style.display = "none";
                instructions.innerHTML = "Take your downloaded file...";

                const element = document.createElement("a");
                element.setAttribute(
                    "href",
                    "data:text/plain;charset=utf-8," +
                        encodeURIComponent(JSON.stringify(data)),
                );

                const fileName = data.session + ".json";
                element.setAttribute("download", fileName);

                element.style.display = "none";
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            }
        </script>
    </body>
</html>
